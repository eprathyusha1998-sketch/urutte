<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Google OAuth</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            text-align: center;
        }
        .test-section {
            background-color: #f0f0f0;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: left;
        }
        button {
            background-color: #4285f4;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px;
        }
        button:hover {
            background-color: #3367d6;
        }
        .google-btn {
            background-color: #db4437;
        }
        .google-btn:hover {
            background-color: #c23321;
        }
        .log {
            background-color: #000;
            color: #0f0;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            text-align: left;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>Google OAuth Debug Page</h1>
    
    <div class="test-section">
        <h3>Test 1: Direct OAuth URL</h3>
        <p>Click this button to test the OAuth endpoint directly:</p>
        <button onclick="testDirectOAuth()">Test Direct OAuth</button>
    </div>
    
    <div class="test-section">
        <h3>Test 2: Google Button (Same as Modal)</h3>
        <p>This button uses the same code as the modal:</p>
        <button class="google-btn" onclick="testGoogleButton()">
            <span id="googleBtnText">Continue with Google</span>
        </button>
    </div>
    
    <div class="test-section">
        <h3>Test 3: Check Current URL</h3>
        <p>Current URL: <span id="currentUrl"></span></p>
        <p>URL Parameters: <span id="urlParams"></span></p>
        <button onclick="checkUrl()">Refresh URL Info</button>
    </div>
    
    <div class="test-section">
        <h3>Console Logs:</h3>
        <div id="logs" class="log"></div>
        <button onclick="clearLogs()">Clear Logs</button>
    </div>
    
    <script>
        let googleLoading = false;
        
        function log(message) {
            const logs = document.getElementById('logs');
            const timestamp = new Date().toLocaleTimeString();
            logs.innerHTML += `[${timestamp}] ${message}\n`;
            logs.scrollTop = logs.scrollHeight;
            console.log(message);
        }
        
        function clearLogs() {
            document.getElementById('logs').innerHTML = '';
        }
        
        function testDirectOAuth() {
            log('Testing direct OAuth URL...');
            window.location.href = 'http://localhost:8080/oauth2/authorization/google';
        }
        
        function testGoogleButton() {
            log('Google button clicked!');
            if (googleLoading) {
                log('Button already loading, ignoring click');
                return;
            }
            
            googleLoading = true;
            document.getElementById('googleBtnText').textContent = 'Redirecting...';
            log('Setting loading state...');
            log('Redirecting to Google OAuth...');
            
            // Small delay to show loading state
            setTimeout(() => {
                log('Executing redirect...');
                window.location.href = 'http://localhost:8080/oauth2/authorization/google';
            }, 100);
        }
        
        function checkUrl() {
            const currentUrl = window.location.href;
            const urlParams = new URLSearchParams(window.location.search);
            const params = {};
            for (const [key, value] of urlParams) {
                params[key] = value;
            }
            
            document.getElementById('currentUrl').textContent = currentUrl;
            document.getElementById('urlParams').textContent = JSON.stringify(params, null, 2);
            
            log('URL checked: ' + currentUrl);
            if (Object.keys(params).length > 0) {
                log('URL parameters: ' + JSON.stringify(params));
            }
        }
        
        // Check for OAuth token on page load
        function checkOAuthResult() {
            const urlParams = new URLSearchParams(window.location.search);
            const token = urlParams.get('token');
            const error = urlParams.get('error');
            
            if (token) {
                log('OAuth Success! Token received: ' + token.substring(0, 20) + '...');
                localStorage.setItem('access_token', token);
                log('Token stored in localStorage');
                // Redirect to feed
                setTimeout(() => {
                    log('Redirecting to feed...');
                    window.location.href = '/feed';
                }, 2000);
            } else if (error) {
                log('OAuth Error: ' + (urlParams.get('message') || 'Unknown error'));
            }
        }
        
        // Initialize
        log('Debug page loaded');
        checkUrl();
        checkOAuthResult();
    </script>
</body>
</html>
